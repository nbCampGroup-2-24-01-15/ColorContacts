
# 트러블 슈팅
## 이상오

### 연락처 추가
------------
#### 1. 이미지 갤러리를 부르고 결과를 받기위해 ActivityResultLauncher를 구성했는데  startActivityForResult가 불러지지가 않음

->  해결 : 상속받은 클래스를 dialog에서 dialogFragment 으로 변경
### DialogFragment 는 Activity에 종속되어있어서 기존 결과값받기 처리가 유용함

반면, dialog 는 종속되지 않아 별개의 생명주기로 인해 더 복잡해짐

------------------
#### 2. Singtone 클래스에 데이터를 업데이트 한후, 해당 뷰에 업로드가 되지않음
->  해결 : DataUpdateListener 인터페이스를 정의하고, 

MainActivity, 해당 프래그먼트(ContactsListFragment)에 상속하여 

기능(onDataUpdate())을 재정의 하여 처리함

- AddContactDialogFragment() : 인터페이스 인스턴스 생성후 확인 버튼을 누르면 메소드 실행

- mainActivity : Viewpager2 에 보이는 프래그먼트를 찾아서 메소드 실행

- ContactsListFragment : setList()을 실행
--------------

### Event 시간에 맞춰 알림 표시

#### 1. class 로 설계하여 구현하는데 context로 permission 등록이 안됨

->  해결 : permission 등록하는 함수를 인자값을 Activitiy로 바꿈

---------------
#### 2. pending Intent를 등록하고, onRecivce를 받아서 처리하는데 기존의 값이 남아있음
-> 해결 : pending Intent 의 인자 flags 값을 바꿔줌
```kotlin
PendingIntent.FLAG_IMMUTABLE ->
PendingIntent.FLAG_IMMUTABLE or PendingIntent.FLAG_UPDATE_CURRENT
```
----------------


## 최영정

### 내 정보와 나머지 연락처 정보 구분해서 처리
------------
#### 1. 기기의 내 번호 정보를 따로 받아오기
내 기기의 번호는 일반 연락처 정보가 아닌 민감한 개인정보로 분류되기 때문에 따로 권한요청을 해야 하고 그 방법은 별로 권장되지는 않는다

→ 그냥 프로필을 작성하는 것처럼 마이페이지에서 사용자가 직접 입력하게 하는 방식을 선택했다

#### 2. 같은 디테일 페이지를 사용하면서 내 정보와 타인 연락처를 구별

-> 마이페이지에 대한 클릭은 프래그먼트 코드에서 감지해서 인텐트로 타입을 보내고 나머지 연락처 리스트 각각에 대한 클릭은 리사이클러뷰의 어댑터에서 처리하도록 했었다
데이터가 한 리스트에 있지 않고 따로 있어서인지nullPointException이나 초기화 에러가 자꾸 발생했다
→ 아예 액티비티를 따로 만들어야 할지 고민했는데 규상님이 리사이클러뷰 뷰 타입으로 다시 만들고 key값만 따로 해서 구분되게 해결을 해 주셨다


### 이벤트 설정 관련
------------
알림을 설정하고 그대로 있거나 페이지를 나가기만 할 때는 정상적으로 알림이 오는데 설정하고 나갔다가 시간이 지나기 전에 다시 해당 연락처의 상세 페이지로 들어가면 설정한 알림이 다시 x로 초기화되는 문제가 있었다

→ 알림 설정 완료 시간으로 계산해서 알림이 울릴 시간을 따로 변수에 저장해두고 그 시간과 현재 시간을 비교해서 이벤트 값을 초기화하는 조건문을 만들면 해결될 것 같다


### 특정 동작이 의도한 대로 되지 않을 때
------------
한 페이지 내에서 나뉘는 경우의 수가 많아서 각 경우에 알맞은 값이 제대로 들어와야 의도한 화면이 나오는데 코드만으로는 이게 되어야 하는데 왜 안 되지 싶은 것들이 있었다.

→ 해당 변수에 대해 로그를 찍어서 어디에서 잘못 들어왔는지 바로 확인하는 것을 습관화하자


### dk 버전 차이 문제
------------
이미지 처리 방식을 변경해서 pull을 했는데 프로젝트 clean을 해도 import가 제대로 되지 않았다

→안드로이드 스튜디오 설정에서 gradle JDK 버전을 바꿨더니 해결되었다


### 이미지 권한 문제 
----------

> 문제

갤러리에서 이미지를 정상적으로 불러왔음에도 화면에 불러온 이미지가 안 보이는 문제가 발생하였다. 

처음에는 코드 문제인줄 알고 코드를 수정해봤지만 코드에는 문제가 없었고 관련 이슈에 대해 검색해보니 권한 관련 문제였다. 

> 원인

기존에 `READ_EXTERNAL_STORAGE` 권한을 사용했는데 Target SDK를 33으로 변경하게 되면 `READ_EXTERNAL_STORAGE`에 대해  세분화가 진행 된다.

기존에 `READ_EXTERNAL_STORAGE` 권한만 적용되어 있다면 이미지 권한이 사라지게 된 것이다. 

> 해결

Manifest에 `READ_MEDIA_IMAGES`에 대한 권한을 선언해주고 해당 권한으로 사용자에게 권한 요청하는 부분을 추가하였다. 

디바이스의 Android SDK VERSION을 확인하여 13(TIRAMISU) 이상일 경우 `READ_MEDIA_IMAGES`를 추가 요청했다. 

